#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
删除词库中的人名词条
根据第一个字是否属于百家姓，且第二个字和第三个字更可能是名字来判断是否为人名
"""

import os
import glob

# 百家姓列表
SURNAMES = {
    '赵', '钱', '孙', '李', '周', '吴', '郑', '王', '冯', '陈', '褚', '卫', '蒋', '沈', '韩', '杨',
    '朱', '秦', '尤', '许', '何', '吕', '施', '张', '孔', '曹', '严', '华', '金', '魏', '陶', '姜',
    '戚', '谢', '邹', '喻', '柏', '水', '窦', '章', '云', '苏', '潘', '葛', '奚', '范', '彭', '郎',
    '鲁', '韦', '昌', '马', '苗', '凤', '花', '方', '俞', '任', '袁', '柳', '酆', '鲍', '史', '唐',
    '费', '廉', '岑', '薛', '雷', '贺', '倪', '汤', '滕', '殷', '罗', '毕', '郝', '邬', '安', '常',
    '乐', '于', '时', '傅', '皮', '卞', '齐', '康', '伍', '余', '元', '卜', '顾', '孟', '平', '黄',
    '和', '穆', '萧', '尹', '姚', '邵', '湛', '汪', '祁', '毛', '禹', '狄', '米', '贝', '明', '臧',
    '计', '伏', '成', '戴', '谈', '宋', '茅', '庞', '熊', '纪', '舒', '屈', '项', '祝', '董', '梁',
    '杜', '阮', '蓝', '闵', '席', '季', '麻', '强', '贾', '路', '娄', '危', '江', '童', '颜', '郭',
    '梅', '盛', '林', '刁', '钟', '徐', '邱', '骆', '高', '夏', '蔡', '田', '樊', '胡', '凌', '霍',
    '虞', '万', '支', '柯', '昝', '管', '卢', '莫', '经', '房', '裘', '缪', '干', '解', '应', '宗',
    '丁', '宣', '贲', '邓', '郁', '单', '杭', '洪', '包', '诸', '左', '石', '崔', '吉', '钮', '龚',
    '程', '嵇', '邢', '滑', '裴', '陆', '荣', '翁', '荀', '羊', '於', '惠', '甄', '曲', '家', '封',
    '芮', '羿', '储', '靳', '汲', '邴', '糜', '松', '井', '段', '富', '巫', '乌', '焦', '巴', '弓',
    '牧', '隗', '山', '谷', '车', '侯', '宓', '蓬', '全', '郗', '班', '仰', '秋', '仲', '伊', '宫',
    '宁', '仇', '栾', '暴', '甘', '钭', '厉', '戎', '祖', '武', '符', '刘', '景', '詹', '束', '龙',
    '叶', '幸', '司', '韶', '郜', '黎', '蓟', '薄', '印', '宿', '白', '怀', '蒲', '邰', '从', '鄂',
    '索', '咸', '籍', '赖', '卓', '蔺', '屠', '蒙', '池', '乔', '阴', '郁', '胥', '能', '苍', '双',
    '闻', '莘', '党', '翟', '谭', '贡', '劳', '逄', '姬', '申', '扶', '堵', '冉', '宰', '郦', '雍',
    '郤', '璩', '桑', '桂', '濮', '牛', '寿', '通', '边', '扈', '燕', '冀', '郏', '浦', '尚', '农',
    '温', '别', '庄', '晏', '柴', '瞿', '阎', '充', '慕', '连', '茹', '习', '宦', '艾', '鱼', '容',
    '向', '古', '易', '慎', '戈', '廖', '庾', '终', '暨', '居', '衡', '步', '都', '耿', '满', '弘',
    '匡', '国', '文', '寇', '广', '禄', '阙', '东', '欧', '殳', '沃', '利', '蔚', '越', '夔', '隆',
    '师', '巩', '厍', '聂', '晁', '勾', '敖', '融', '冷', '訾', '辛', '阚', '那', '简', '饶', '空',
    '曾', '毋', '沙', '乜', '养', '鞠', '须', '丰', '巢', '关', '蒯', '相', '查', '后', '荆', '红',
    '游', '竺', '权', '逯', '盖', '益', '桓', '公', '万俟', '司马', '上官', '欧阳', '夏侯', '诸葛',
    '闻人', '东方', '赫连', '皇甫', '尉迟', '公羊', '澹台', '公冶', '宗政', '濮阳', '淳于', '单于',
    '太叔', '申屠', '公孙', '仲孙', '轩辕', '令狐', '钟离', '宇文', '长孙', '慕容', '鲜于', '闾丘',
    '司徒', '司空', '亓官', '司寇', '仉', '督', '子车', '颛孙', '端木', '巫马', '公西', '漆雕', '乐正',
    '壤驷', '公良', '拓跋', '夹谷', '宰父', '谷梁', '晋', '楚', '闫', '法', '汝', '鄢', '涂', '钦',
    '段干', '百里', '东郭', '南门', '呼延', '归', '海', '羊舌', '微生', '岳', '帅', '缑', '亢', '况',
    '后', '有', '琴', '梁丘', '左丘', '东门', '西门', '商', '牟', '佘', '佴', '伯', '赏', '南宫', '墨',
    '哈', '谯', '笪', '年', '爱', '阳', '佟', '第五', '言', '福'
}

# 常见人名用字（第二、三个字）
# 这些是通常用于人名中的字，与姓氏组合更可能是人名
COMMON_NAME_CHARS = {
    '伟', '芳', '娜', '秀', '敏', '静', '丽', '强', '磊', '军', '洋', '勇', '艳', '杰', '娟', '涛', 
    '明', '超', '秀', '霞', '平', '刚', '桂', '英', '莉', '波', '文', '艳', '彬', '华', '红', '艳', 
    '峰', '颖', '杰', '丹', '萍', '鹏', '辉', '龙', '飞', '雪', '梅', '丹', '燕', '霞', '琳', '玲', 
    '晶', '宁', '楠', '爽', '哲', '帅', '慧', '晨', '曦', '阳', '明', '辉', '俊', '杰', '豪', '轩', 
    '宇', '辰', '浩', '洋', '博', '涛', '然', '瑞', '智', '涵', '怡', '然', '佳', '欣', '悦', '心', 
    '依', '语', '诗', '雨', '梦', '佳', '可', '心', '思', '涵', '雅', '静', '怡', '琳', '璐', '瑶', 
    '瑾', '琪', '彤', '欣', '怡', '佳', '嘉', '慧', '雪', '冰', '玉', '洁', '秀', '娟', '丽', '艳', 
    '春', '秋', '冬', '夏', '山', '水', '金', '木', '火', '土', '松', '竹', '梅', '兰', '菊', '荷', 
    '安', '平', '定', '福', '贵', '祥', '瑞', '宝', '珠', '珍', '玉', '龙', '凤', '虎', '豹', '鹰', 
    '德', '仁', '义', '礼', '智', '信', '忠', '孝', '勇', '刚', '毅', '勤', '俭', '朴', '真', '善', 
    '美', '雅', '正', '大', '光', '明', '国', '家', '民', '族', '志', '远', '志', '明', '亮', '星', 
    '光', '辉', '荣', '华', '富', '贵', '康', '健', '长', '寿', '福', '禄', '寿', '喜', '财', '祥'
}

def is_name(word):
    """
    判断词语是否为三字人名
    基于第一个字是否为百家姓中的姓氏，且后续字是否为人名常用字
    """
    if len(word) != 3:  # 只处理三个字的词语
        return False
    
    first_char = word[0]
    second_char = word[1]
    third_char = word[2]
    
    # 检查第一个字是否为姓氏
    if first_char not in SURNAMES:
        return False
    
    # 检查第二个和第三个字是否为常用人名字
    # 如果两个字中至少有一个是常用人名字，就认为是人名
    # 但也要考虑一些常见的非人名组合
    is_likely_name = (second_char in COMMON_NAME_CHARS or third_char in COMMON_NAME_CHARS)
    
    # 特殊处理一些常见的非人名组合
    non_name_combinations = {
        '王八蛋', '王八羔', '王八子', '王八鱼', '王八虫', '王八鸟', '王八兽', '王八畜', 
        '王八货', '王八怪', '王八精', '王八鬼', '王八神', '王八仙', '王八佛', '王八魔',
        '王八鬼', '王八怪', '王八精', '王八仙', '王八佛', '王八魔', '王八虫', '王八兽',
        '王八畜', '王八货', '王八怪', '王八精', '王八仙', '王八佛', '王八魔', '王八鬼',
        '王八蛋', '王八羔', '王八子', '王八鱼', '王八虫', '王八鸟', '王八兽', '王八畜',
        '李子涵', '李子墨', '李子轩', '李子涵', '李子墨', '李子轩', '李子涵', '李子墨', 
        '李子轩', '李子涵', '李子墨', '李子轩', '李子涵', '李子墨', '李子轩', '李子涵',
        '李子墨', '李子轩', '李子涵', '李子墨', '李子轩', '李子涵', '李子墨', '李子轩',
        '张三丰', '张三石', '张三水', '张三木', '张三金', '张三土', '张三火', '张三龙',
        '张三虎', '张三豹', '张三狼', '张三狗', '张三猫', '张三鸟', '张三鱼', '张三虫',
        '张三兽', '张三畜', '张三货', '张三怪', '张三精', '张三仙', '张三佛', '张三魔',
        '张三鬼', '张三神', '张三妖', '张三怪', '张三精', '张三仙', '张三佛', '张三魔',
        '张三鬼', '张三神', '张三妖', '张三怪', '张三精', '张三仙', '张三佛', '张三魔',
        '张三鬼', '张三神', '张三妖', '张三怪', '张三精', '张三仙', '张三佛', '张三魔'
    }
    
    # 检查是否为特殊非人名组合
    if word in non_name_combinations:
        return False
    
    # 检查是否包含一些非人名的后缀
    non_name_suffixes = ('八蛋', '八羔', '八子', '八鱼', '八虫', '八鸟', '八兽', '八畜', 
                        '八货', '八怪', '八精', '八仙', '八佛', '八魔', '八鬼', '八神', 
                        '八妖', '三丰', '三石', '三水', '三木', '三金', '三土', '三火', 
                        '三龙', '三虎', '三豹', '三狼', '三狗', '三猫', '三鸟', '三鱼', 
                        '三虫', '三兽', '三畜', '三货', '三怪', '三精', '三仙', '三佛', 
                        '三魔', '三鬼', '三神', '三妖')
    
    if word[1:] in non_name_suffixes:
        return False
    
    return is_likely_name

def remove_names(file_path):
    """
    删除文件中的人名词条
    """
    with open(file_path, 'r', encoding='utf-8') as f:
        lines = f.readlines()
    
    filtered_lines = []
    removed_count = 0
    kept_count = 0
    
    for line in lines:
        line = line.strip()
        if not line:
            continue
        
        # 分割行，获取中文词语部分（第一部分）
        parts = line.split(' ', 1)
        if len(parts) < 2:
            # 如果格式不正确，保留原行
            filtered_lines.append(line + '\n')
            continue
            
        chinese_word = parts[0]
        
        # 检查是否为人名
        if not is_name(chinese_word):
            # 不是人名则保留
            filtered_lines.append(line + '\n')
            kept_count += 1
        else:
            # 是人名则跳过（即删除）
            removed_count += 1
    
    print(f"从 {file_path} 中删除了 {removed_count} 个人名词条，保留了 {kept_count} 个非人名词条")
    return filtered_lines

def main():
    # 获取当前目录下所有的.txt文件
    txt_files = glob.glob("*.txt")
    
    print(f"找到 {len(txt_files)} 个txt文件: {txt_files}")
    print(f"百家姓包含 {len(SURNAMES)} 个姓氏")
    print(f"常用人名字包含 {len(COMMON_NAME_CHARS)} 个字")
    
    for file_path in txt_files:
        print(f"正在处理文件: {file_path}")
        
        try:
            filtered_lines = remove_names(file_path)
            
            # 备份原文件
            backup_path = file_path + ".backup_names_removed"
            os.rename(file_path, backup_path)
            
            # 写入过滤后的内容
            with open(file_path, 'w', encoding='utf-8') as f:
                f.writelines(filtered_lines)
            
            print(f"已处理完成: {file_path} (原文件已备份为 {backup_path})")
            print(f"原始行数: {sum(1 for line in open(backup_path, 'r', encoding='utf-8'))}, 过滤后行数: {len(filtered_lines)}")
        
        except Exception as e:
            print(f"处理文件 {file_path} 时出错: {str(e)}")
    
    print("\n所有文件处理完成！")

if __name__ == "__main__":
    main()
