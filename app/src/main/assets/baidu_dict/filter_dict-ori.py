#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
精简词库文件，删除包含5个或更多字符的词组的行以及包含不常见字的词条
"""

import os
import glob

# 从用户提供的汉字拼音字典中提取的不常见字
# 这些字通常比较复杂，使用频率较低
# 已去除重复字符，增加更多复杂不常见字
UNCOMMON_CHARS = {
    # 超复杂汉字
    '爨', '灪', '鱻', '龘', '靐', '齉', '齾', '龜', '龠', '厵', '沝', '淼', '垚', '尛', '掱', '砳', '祤', '騳', '麣', '鞻', '韽', '驫', '爩', '騄', '騣', '騱', '騷', '驦', '驨', '驩', '驪', '驤', '驥', '顙', '顛', '顢', '顣', '顥', '顫', '顬', '顰', '顲', '顳', '饞', '饟', '饠', '饡', '饢',
    
    # 复杂偏旁部首字
    '癵', '癶', '癷', '癸', '癹', '発', '發', '瞜', '瞞', '瞝', '瞫', '瞭', '瞡', '瞢', '瞣', '瞤', '瞦', '瞧', '瞨', '瞩', '瞪', '瞫', '瞬', '瞭', '瞮', '瞯', '瞰', '瞱', '瞲', '瞴', '瞵', '瞶', '瞷', '瞸', '瞹', '瞺', '瞻', '瞼', '瞾', '瞿', '矝', '矞', '矧', '矡', '睼', '眊', '矪', '矫', '矬', '矲', '矱', '矻', '矼',
    
    # 石字旁复杂字
    '砅', '砆', '砇', '砊', '砋', '砎', '砏', '砐', '砑', '砓', '砕', '砖', '砗', '砙', '砛', '砞', '砟', '砢', '砤', '砨', '砪', '砫', '砬', '砭', '砮', '砯', '砵', '砱', '砲', '砳', '砶', '砽', '砄', '砿', '硁', '硂', '硃', '硄', '硊', '硈', '硍', '硋', '煍', '硙', '硚', '硏', '硑', '硒', '硓', '硔', '硘', '硊', '硛', '硜', '硞', '硟', '硠', '硡', '硢', '硣', '硤', '硥', '硦', '硧', '硨', '硩', '硪', '硫', '硬', '硭', '确', '硯', '硰', '硱', '硲', '硴', '硵', '硶', '硷', '硸', '硹', '硺', '硻', '硽', '硾', '硿', '碀', '碁', '碂', '碃', '碄', '碅', '碆', '碈', '碋', '碏', '碍', '碔', '碕', '碖', '碙', '碛', '碝', '碞', '碠', '碡', '碢', '碤', '碥', '碦', '碨', '碩', '碪', '碫', '碬', '碭', '碮', '碯', '磀', '磂', '磃', '磄', '磆', '磇', '磈', '磉', '磌', '磍', '磎', '磏', '磑', '磒', '磓', '磔', '磖', '磗', '磘', '磚', '磜', '磝', '磟', '磠', '磢', '磣', '磤', '磥', '磦', '磧', '磩', '磪', '磫', '磭', '磮', '磯', '磰', '磱', '磳', '磵', '磶', '磸', '磹', '磺', '磻', '磼', '磽', '磾', '磿', '礀', '礁', '礂', '礃', '礄', '礁', '礆', '礇', '礈', '礉', '礊', '礌', '礍', '礎', '礐', '礑', '礒', '礓', '礔', '礕', '礖', '礗', '礘', '礙', '礛', '礜', '礞', '礟', '礠', '礡', '礢', '礣', '礤', '礥', '礦', '礧', '礨', '礩', '礪', '礫', '礬', '礭', '礮', '礯', '礰', '礱', '礲', '礳', '礵', '礶', '礷', '礸', '礹',
    
    # 示字旁复杂字
    '示', '礻', '禃', '禆', '禇', '禈', '禉', '禔', '禌', '禛', '禎', '禐', '禑', '禒', '禓', '禔', '禕', '禖', '禗', '禘', '禜', '禝', '禞', '禛', '禠', '禡', '禢', '禤', '禥', '禦', '禨', '禩', '禪', '禫', '禬', '禭', '禮', '禯', '禰', '禱', '禲', '禴', '禵', '禶', '禷', '禸', '禹', '禺', '禼', '禽', '禿',
    
    # 禾字旁复杂字
    '秂', '秄', '秅', '秇', '秈', '秊', '秌', '秎', '秏', '秐', '秓', '秔', '秕', '秖', '秗', '秙', '秚', '秛', '秜', '秝', '秞', '秠', '秡', '秢', '秥', '秨', '秪', '秫', '秮', '秱', '秲', '秳', '秴', '秵', '秶', '秷', '秹', '秺', '移', '秼', '秾', '秿', '稁', '稂', '稃', '稄', '稅', '稆', '稇', '稈', '稉', '稊', '稌', '稑', '稏', '稐', '稑', '稒', '稓', '稕', '稖', '稘', '稙', '稛', '稜', '稝', '稞', '稟', '稡', '稢', '稤', '稥', '稦', '稧', '稨', '稩', '稪', '稫', '稬', '稭', '稯', '稰', '稱', '稲', '稴', '稵', '稶', '稸', '稺', '稾', '稿', '穀', '穁', '穂', '穃', '穄', '穅', '穇', '穄', '穊', '穋', '穜', '穕', '穖', '穘', '穙', '穟', '穛', '穜', '穝', '穞', '穟', '穠', '穡', '穢', '穣', '穤', '穥', '穧', '穨', '穩', '穪', '穫', '穬', '穭', '穮', '穯', '穰', '穱', '穲', '穳',
    
    # 穴字旁复杂字
    '穴', '穵', '究', '穷', '穸', '穹', '空', '穻', '穼', '穽', '穾', '穿', '窂', '窅', '窇', '窊', '窋', '窌', '窎', '窏', '窐', '窔', '窕', '窙', '窚', '窛', '窊', '窝', '窞', '窎', '窡', '窢', '窸', '窫',
    
    # 生僻字
    '亜', '亝', '亞', '亣', '亪', '亯', '亰', '亱', '亴', '亶', '亷', '亸', '亹', '亼', '亽', '亾', '仼', '仾', '伀', '伂', '伃', '伄', '伅', '伆', '伇', '伈', '伋', '伌', '伒', '伓', '伔', '伕', '伖', '伜', '伝', '伡', '伣', '伨', '伩', '伮', '伱', '伳', '伵', '伷', '伹', '伻', '伾', '佀', '佁', '佂', '佄', '佅', '佇', '佉', '佊', '佋', '佌', '佒', '佔', '佖', '佡', '佢', '佦', '佧', '佨', '佪', '佫', '佭', '佮', '佱', '佲', '併', '佷', '佸', '佹', '佺', '佽', '侀', '侁', '侂', '侅', '來', '侇', '侈', '侉', '侊', '例', '侎', '侐', '侒', '侓', '侔', '俍', '俎', '侙', '侚', '侗', '侘', '侢', '侤', '侥', '侦', '侘', '侫',
    
    # 更多复杂字
    '凊', '凎', '凐', '凒', '凓', '凔', '凕', '凗', '凘', '凙', '凚', '凜', '凞', '凟', '凢', '凣', '凥', '処', '凧', '凨', '凩', '凪', '凬', '凘', '凮', '凯', '凲', '凴', '凵', '凷', '凸', '凹', '出', '击', '凼', '函', '凾',
    
    # 扩展复杂字
    '饣', '飣', '餈', '餑', '餒', '餕', '餖', '餚', '餛', '餜', '餞', '餤', '餧', '餩', '餪', '餫', '餬', '餯', '餱', '餴', '餵', '餶', '餷', '餸', '餹', '餺', '餻', '餼', '餽', '餾', '餿', '饀', '饁', '饂', '饃', '饄', '饅', '饆', '饇', '饈', '饉', '饊', '饋', '饌', '饍',
    
    # 更多生僻字
    '癶', '癷', '癹', '発', '發', '癸', '癿', '皀', '皁', '皃', '皅', '皉', '皌', '皍', '皞', '皐', '皒', '皔', '皕', '皗', '皘', '皚', '皜', '皞', '皝', '皟', '皠', '皡', '皢', '皣', '皥', '皧', '皨', '皩', '皫', '皬', '皭', '皯', '皰', '皳', '皵', '皶', '皷', '皸', '皹', '皺', '皻', '皼', '皾',
    
    # 扩展不常见字
    '盀', '盁', '盃', '盄', '盇', '盋', '盌', '盍', '盓', '盕', '盙', '盚', '盜', '盝', '盞', '盠', '盢', '監', '監', '盩', '盪', '盫', '盬', '盭', '盰', '盱', '盳', '盵', '盶', '盺', '盻', '盽', '盿', '眀', '眂', '眃', '眅', '眆', '眊', '眎', '眏', '眑', '眒', '眓', '眔', '眕', '眖', '眗', '眘', '眛', '眜', '眝', '眞', '眡', '眣', '眤', '眥', '眧', '眊', '眫', '眮', '眰', '眱', '眲', '眴', '眵', '眹', '眻', '眽', '眿'
}

def contains_uncommon_chars(text):
    """
    检查文本中是否包含不常见的字符
    """
    for char in text:
        if char in UNCOMMON_CHARS:
            return True
    return False

def filter_words(file_path):
    """
    过滤掉包含5个或更多字符的词组的行以及包含不常见字的词条
    """
    with open(file_path, 'r', encoding='utf-8') as f:
        lines = f.readlines()
    
    filtered_lines = []
    for line in lines:
        line = line.strip()
        if not line:
            continue
        
        # 分割行，获取中文词语部分（第一部分）
        parts = line.split(' ', 1)
        if len(parts) < 2:
            # 如果格式不正确，保留原行
            filtered_lines.append(line + '\n')
            continue
            
        chinese_word = parts[0]
        
        # 计算中文词语的字符数
        word_length = len(chinese_word)
        
        # 检查是否包含不常见字符
        has_uncommon_char = contains_uncommon_chars(chinese_word)
        
        # 如果词语长度小于5且不包含不常见字符，则保留
        if word_length < 4 and not has_uncommon_char:
            filtered_lines.append(line + '\n')
    
    return filtered_lines

def main():
    # 获取当前目录下所有的.txt文件
    txt_files = glob.glob("*.txt")
    
    print(f"找到 {len(txt_files)} 个txt文件: {txt_files}")
    
    for file_path in txt_files:
        print(f"正在处理文件: {file_path}")
        
        try:
            filtered_lines = filter_words(file_path)
            
            # 备份原文件
            backup_path = file_path + ".backup2"
            os.rename(file_path, backup_path)
            
            # 写入过滤后的内容
            with open(file_path, 'w', encoding='utf-8') as f:
                f.writelines(filtered_lines)
            
            print(f"已处理完成: {file_path} (原文件已备份为 {backup_path})")
            print(f"原始行数: {sum(1 for line in open(backup_path, 'r', encoding='utf-8'))}, 过滤后行数: {len(filtered_lines)}")
        
        except Exception as e:
            print(f"处理文件 {file_path} 时出错: {str(e)}")
    
    print("\n所有文件处理完成！")

if __name__ == "__main__":
    main()
